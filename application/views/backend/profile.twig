{% extends "template/backend.twig" %}

{% block styles %}
<link rel="stylesheet" href="{{ base_url() }}assets/oneui/js/plugins/datatables/jquery.dataTables.min.css">
<link rel="stylesheet" href="{{ base_url() }}assets/oneui/js/plugins/cropper/dist/cropper.min.css">
<link rel="stylesheet" href="{{ base_url() }}assets/oneui/js/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" href="{{ base_url() }}assets/oneui/js/plugins/summernote/summernote.min.css">
<link rel="stylesheet" href="{{base_url()}}assets/sweetalert/dist/sweetalert.css" >
<link rel="stylesheet" href="{{base_url()}}assets/oneui/css/bootstrap-editable.css" >
<style>
    .fileUpload {
        position: relative;
        overflow: hidden;
    }
    .fileUpload input.upload {
        position: absolute;
        top: 0;
        right: 0;
        margin: 0;
        padding: 0;
        font-size: 20px;
        cursor: pointer;
        opacity: 0;
        filter: alpha(opacity=0);
    }

    .fileUpload input.uploadBG {
        position: absolute;
        top: 0;
        right: 0;
        margin: 0;
        padding: 0;
        font-size: 20px;
        cursor: pointer;
        opacity: 0;
        filter: alpha(opacity=0);
    }

    #imgPreview, #imgPreview-update{
        /*border-radius:50%;*/
        /*margin-bottom: 15px;*/
    }
</style>
{% endblock %}

{% block body %}
<div class="content wrap-breadcrum" style="margin-top:-10px">
    <div class="col-sm-12 text-right hidden-xs">
        <ol class="breadcrumb">
            <li><a href="{{base_url()}}" class="link-effect">Dashboard</a></li>
            <li>Profil</li>
        </ol>
    </div>
</div>

<!-- Main Container -->
<div class="content content-boxed">
    <div class="row">
        <div class="col-md-12">
          <div class="block">
            <div class="block-content block-content-full" style="text-align:justify !important;">

            <div class="row">
            <div class="col-md-1"></div>
                <div class="col-md-8">
                   <table class="table">
                      <tr>
                        <th colspan="3">
                            <center>
                                Profil Perusahaan
                            </center>
                        </th>
                      </tr>
                        <tr>
                          <th colspan="3">
                            Identitas Perusahaan
                          </th>
                        </tr>

                        <tr>
                            <td width="30%">Nama Perusahaan</td>
                            <td width="1">:</td>
                            <td>
                              <a id="prof_company_name" href="#" data-type="text" data-pk="1" data-title="Nama Perusahaan" class="editable editable-click">{{profile.prof_company_name}}</a>
                            </td>
                        </tr>
                        <tr>
                            <td>Review</td>
                            <td>:</td>
                            <td>
                              <a id="prof_review" href="#" data-type="textarea" data-pk="1" data-title="Review" class="editable editable-click">{{profile.prof_review}}</a>

                            </td>
                        </tr>

                        <tr>
                            <td>Deskripsi Perusahaan</td>
                            <td>:</td>
                            <td>
                                <a id="prof_desc" href="#" data-type="textarea" data-pk="1" data-title="Deskripsi" class="editable editable-click">{{profile.prof_desc}}</a>
                              </td>
                        </tr>

                        <!-- <tr>
                            <td>Status</td>
                            <td>:</td>
                            <td>{{profile.prof_status}}</td>
                        </tr> -->

                    </table>

                    <form class="form-update-bg js-form1 validation form-horizontal" action="{{base_url()}}backend/profile/update_background/{{profile.prof_id}}" method="post">
                        <div class="form-group">
                            <div class="col-xs-12">
                            {% if profile.prof_background %}
                                <img id="imgPreview-bg" width="100%" src="../{{profile.prof_background}}">
                            {% else %}
                                <img id="imgPreview-bg" width="100%" src="{{base_url()}}assets/oneui/img/avatars/image.png">
                            {% endif %}
                              <div class="fileUpload btn btn-default btn-flat btn-block" style="width:100%">
                                  <span>Ubah Background Beranda</span>
                                  <input type="file" class="uploadBG" name="ImageFile" id="imageInput" required/>
                                  <input type="hidden" class="" name="srcDataCrop-bg" id="srcDataCrop-bg"/>
                              </div>
                              <!-- <small class="text-muted">Rasio 2:3</small> -->
                            </div>
                        </div>
                      </form>

                </div>
                <div class="col-md-2 ">
                      <form class="form-update-logo js-form1 validation form-horizontal" action="{{base_url()}}backend/profile/update_logo/{{profile.prof_id}}" method="post">
                          <div class="form-group">
                              <div class="col-xs-12">
                              {% if profile.prof_logo %}
                                  <img id="imgPreview" width="90%" src="../{{profile.prof_logo}}">
                              {% else %}
                                  <img id="imgPreview" width="90%" src="{{base_url()}}assets/oneui/img/avatars/avatar1.jpg">
                              {% endif %}
                                <!-- <div class="fileUpload btn btn-default btn-flat btn-block" style="width:90%">
                                    <span>Ubah Logo</span>
                                    <input type="file" class="upload" name="ImageFile" id="imageInput" required/>
                                    <input type="hidden" class="" name="srcDataCrop" id="srcDataCrop"/>

                                </div> -->

                              </div>
                          </div>
                        </form>

                </div>
                <div class="col-md-1"></div>
            </div>
            </div></div>
        </div>
    </div>

</div>

<!-- Modal croper -->
<div class="modal fade" id="cropper-modal" data-backdrop="static" data-keyboard="false" tabindex="-1" >
  <div class="modal-dialog modal-dialog-popout modal-dialog-top">
    <div class="modal-content">
        <div class="block block-themed block-transparent remove-margin-b">
            <div class="block-header bg-primary-dark">
                <ul class="block-options">
                    <li>
                        <button data-dismiss="modal" type="button"><i class="si si-close"></i></button>
                    </li>
                </ul>
                <h3 class="block-title">Image Cropper</h3>
            </div>
            <div class="block-content">
                <div id="cropper-wrap-img">
                    <img width="100%" src="{{base_url()}}assets/oneui/img/default.png" alt="Picture">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-default pull-left">Close</button>
            <button type="button" class="btn btn-primary btn-crop">Crop</button>
        </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cropper-modalBG" data-backdrop="static" data-keyboard="false" tabindex="-1" >
  <div class="modal-dialog modal-dialog-popout modal-dialog-top">
    <div class="modal-content">
        <div class="block block-themed block-transparent remove-margin-b">
            <div class="block-header bg-primary-dark">
                <ul class="block-options">
                    <li>
                        <button data-dismiss="modal" type="button"><i class="si si-close"></i></button>
                    </li>
                </ul>
                <h3 class="block-title">Image Cropper</h3>
            </div>
            <div class="block-content">
                <div id="cropper-wrap-img">
                    <img width="100%" src="{{base_url()}}assets/oneui/img/default.png" alt="Picture">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-default pull-left">Close</button>
            <button type="button" class="btn btn-primary btn-cropBG">Crop</button>
        </div>
    </div>
  </div>
</div>

<input type="hidden" value="{{ base_url() }}" class="base_url" />
<input type="hidden" value="{{profile.prof_id}}" class="studentId" />
{% endblock %}

{% block scripts %}

<script src="{{ base_url() }}assets/oneui/js/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/shiftcheckbox/jquery.shiftcheckbox.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/cropper/dist/cropper.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/bootstrap-datetimepicker/moment.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<!-- Page JS Code -->
<script src="{{ base_url() }}assets/oneui/js/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>
<script src="{{ base_url() }}assets/oneui/js/pages/base_forms_wizard.js"></script>
<script src="{{base_url()}}assets/sweetalert/dist/sweetalert.min.js"></script>
<!-- <script src="{{ base_url() }}assets/oneui/js/pages/prof_password.js"></script> -->

<script src="{{ base_url() }}assets/oneui/js/bootstrap-editable.js"></script>
<script src="{{ base_url() }}assets/oneui/js/pages/adm_profile.js"></script>
<script>
    jQuery(function () {
        $('#birthdate-add-student').datetimepicker({
            format: 'YYYY-MM-DD',
            showTodayButton: true,
            showClose: true,
            icons: {
                time: 'si si-clock',
                date: 'si si-calendar',
                up: 'si si-arrow-up',
                down: 'si si-arrow-down',
                previous: 'si si-arrow-left',
                next: 'si si-arrow-right',
                today: 'si si-size-actual',
                clear: 'si si-trash',
                close: 'si si-close'
            }
        });
        $('#birthdate-update-student').datetimepicker({
            format: 'YYYY-MM-DD',
            showTodayButton: true,
            showClose: true,
            icons: {
                time: 'si si-clock',
                date: 'si si-calendar',
                up: 'si si-arrow-up',
                down: 'si si-arrow-down',
                previous: 'si si-arrow-left',
                next: 'si si-arrow-right',
                today: 'si si-size-actual',
                clear: 'si si-trash',
                close: 'si si-close'
            }
        });
    });


    // Logo
    $('input.upload').on('change', function(e) {
        if (this.files && this.files[0].name.match(/\.(jpg|jpeg|png|JPG|JPEG|PNG)$/)) {
            var image = $('#cropper-wrap-img > img'), cropBoxData, canvasData;
            var reader = new FileReader();
            reader.onload = function(e) {
                image.attr('src', e.target.result);
            };

            reader.readAsDataURL(this.files[0]);
            $('#cropper-modal').modal('show');
        }else {
            alert('file not supported');
        }
    });

    $('#cropper-modal').on('shown.bs.modal', function() {
        var image = $('#cropper-wrap-img > img'), cropBoxData, canvasData;
        image.cropper({
            aspectRatio: 1 / 1,
            autoCropArea: 0.5,
            cropBoxResizable: true,
            checkImageOrigin: true,
            responsive: true,
            built: function() {
                // Strict mode: set crop box data first
                image.cropper('setCropBoxData', cropBoxData);
                image.cropper('setCanvasData', canvasData);
            },
        });
    });


    $('.btn-crop').on('click', function(e) {
        var imgb64 = $('#cropper-wrap-img > img').cropper('getCroppedCanvas').toDataURL('image/png');
        $('img#imgPreview').attr('src', imgb64);
        $('#srcDataCrop').val(imgb64);
        $('img#imgPreview-update').attr('src', imgb64);
        $('#srcDataCrop-update').val(imgb64);
        var data = $('.form-update-logo').serialize();
        var action = $('.form-update-logo').attr('action');
        $.ajax({
            url: action,
            method: 'POST',
            data: data,
            timeout: 10000,
            success: function(res) {
                res = $.parseJSON(res);
                if (res.data == '1') {
                    swal({
                      title: "Success",
                      text: "logo berhasil diubah!!",
                      type: "success",
                      // showCancelButton: true,
                      confirmButtonColor: "#3498DB",
                      confirmButtonText: "Ok",
                      // cancelButtonText: "Tetap Disini",
                      closeOnConfirm: true
                    },
                    function(){
                          window.location.reload();
                    });
                } else {
                    swal("Oops...", res.data, "error");
                }
            },
            error: function(jqXHR, exception) {
                alert(jqXHR.statusText);
            },
        });
        $('#cropper-modal').modal('hide');
    });

    $('#cropper-modal').on('hidden.bs.modal', function() {
        $('#cropper-wrap-img > img').cropper('destroy');
        // $('body').addClass('modal-open');
    });

</script>
{% endblock %}
